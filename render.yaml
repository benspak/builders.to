# Render.com Blueprint
# https://render.com/docs/blueprint-spec

services:
  # Next.js Web Service
  - type: web
    name: builders-to
    runtime: node
    region: oregon # or: ohio, frankfurt, singapore
    plan: starter # free, starter, standard, pro
    buildCommand: chmod +x ./scripts/render-build.sh && ./scripts/render-build.sh
    startCommand: chmod +x ./scripts/render-start.sh && ./scripts/render-start.sh
    healthCheckPath: /
    # Persistent disk for user uploads
    disk:
      name: uploads
      mountPath: /var/data/uploads
      sizeGB: 1
    envVars:
      - key: NODE_ENV
        value: production
      - key: AUTH_TRUST_HOST
        value: "true"
      - key: UPLOAD_DIR
        value: /var/data/uploads
      - key: DATABASE_URL
        fromDatabase:
          name: builders-to-db
          property: connectionString
      - key: NEXTAUTH_URL
        sync: false # Set this manually after deployment
      - key: NEXTAUTH_SECRET
        generateValue: true
      - key: TWITTER_CLIENT_ID
        sync: false
      - key: TWITTER_CLIENT_SECRET
        sync: false

databases:
  # PostgreSQL Database
  - name: builders-to-db
    region: oregon # Should match web service region
    plan: Basic-256mb # free, starter, standard, pro
    databaseName: builders_to
    user: builders_to_user
    ipAllowList: [] # Allow all IPs (Render services connect internally)
